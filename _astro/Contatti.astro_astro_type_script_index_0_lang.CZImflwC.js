import{a as g}from"./analytics.B1pmlTpN.js";const b=/^[^\s@]+@[^\s@]+\.[^\s@]+$/,h="https://contact.abitarebene.it/send";function v(){const e=document.getElementById("contact-form");return e?{form:e,name:e.querySelector("#name"),email:e.querySelector("#email"),phone:e.querySelector("#phone"),subject:e.querySelector("#subject"),message:e.querySelector("#message"),honeypot:e.querySelector('input[name="website"]'),submitBtn:e.querySelector("#submit-btn"),submitText:e.querySelector("#submit-text"),submitSpinner:e.querySelector("#submit-spinner"),successMsg:document.getElementById("form-success"),errorMsg:document.getElementById("form-error")}:null}function p(e){const r={};return e.name.value.trim()?e.name.value.length>100&&(r.name="Il nome non può superare i 100 caratteri"):r.name="Il nome è obbligatorio",e.email.value.trim()?b.test(e.email.value)||(r.email="Inserisci un indirizzo email valido"):r.email="L'email è obbligatoria",e.phone.value&&e.phone.value.length>20&&(r.phone="Il numero di telefono non può superare i 20 caratteri"),e.subject.value||(r.subject="Seleziona un argomento"),e.message.value.trim()?e.message.value.length>2e3&&(r.message="Il messaggio non può superare i 2000 caratteri"):r.message="Il messaggio è obbligatorio",{valid:Object.keys(r).length===0,errors:r}}function o(e,r){const t=document.getElementById(`${e}-error`),s=document.getElementById(e);t&&(t.textContent=r,t.classList.remove("hidden")),s&&(s.classList.add("border-error"),s.classList.remove("border-border"))}function a(e){const r=document.getElementById(`${e}-error`),t=document.getElementById(e);r&&(r.textContent="",r.classList.add("hidden")),t&&(t.classList.remove("border-error"),t.classList.add("border-border"))}function f(){["name","email","phone","subject","message"].forEach(a)}function l(e){f(),Object.entries(e).forEach(([r,t])=>{o(r,t)})}function L(e){const t=new URLSearchParams(window.location.search).get("subject");if(t){const i={investment:"investment",partnership:"partnership",general:"general",other:"other"};i[t]&&(e.subject.value=i[t])}const s=window.location.hash;if(s.includes("subject=")){const i=s.match(/subject=(\w+)/);if(i&&i[1]){const u=i[1];["investment","partnership","general","other"].includes(u)&&(e.subject.value=u)}}}function d(e,r){e.submitBtn.disabled=r,r?(e.submitText.classList.add("hidden"),e.submitSpinner.classList.remove("hidden")):(e.submitText.classList.remove("hidden"),e.submitSpinner.classList.add("hidden"))}function E(e){e.successMsg.classList.add("hidden"),e.errorMsg.classList.add("hidden")}function m(e){e.successMsg.classList.remove("hidden"),e.errorMsg.classList.add("hidden"),e.successMsg.scrollIntoView({behavior:"smooth",block:"nearest"})}function n(e,r){const t=e.errorMsg.querySelector("p");t&&(t.textContent=r),e.errorMsg.classList.remove("hidden"),e.successMsg.classList.add("hidden"),e.errorMsg.scrollIntoView({behavior:"smooth",block:"nearest"})}async function y(e){if(e.submitBtn.disabled)return;const r=p(e);if(!r.valid){l(r.errors);return}if(e.honeypot?.value){m(e);return}d(e,!0),E(e),f();try{const t=await fetch(h,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:e.name.value.trim(),email:e.email.value.trim(),phone:e.phone.value.trim()||void 0,subject:e.subject.value,message:e.message.value.trim(),website:e.honeypot?.value||""})}),s=await t.json();t.ok&&s.success?(m(e),g("contact",e.subject.value),e.form.reset()):t.status===429?n(e,"Troppi tentativi. Riprova tra qualche minuto."):s.error==="validation_error"&&s.field?l({[s.field]:s.message}):n(e,s.message||"Si è verificato un errore.")}catch(t){console.error("Form submission error:",t),n(e,"Si è verificato un errore. Prova a contattarci via WhatsApp.")}finally{d(e,!1)}}function c(){const e=v();e&&(L(e),e.name.addEventListener("blur",()=>{e.name.value.trim()?a("name"):o("name","Il nome è obbligatorio")}),e.email.addEventListener("blur",()=>{e.email.value.trim()?b.test(e.email.value)?a("email"):o("email","Inserisci un indirizzo email valido"):o("email","L'email è obbligatoria")}),e.subject.addEventListener("change",()=>{e.subject.value&&a("subject")}),e.message.addEventListener("blur",()=>{e.message.value.trim()?a("message"):o("message","Il messaggio è obbligatorio")}),e.form.addEventListener("submit",async r=>{r.preventDefault(),await y(e)}))}typeof document<"u"&&(document.addEventListener("DOMContentLoaded",c),document.addEventListener("astro:page-load",c));c();
